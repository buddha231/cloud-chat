{% load static%}
<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <!-- <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous" /> -->
    <link rel="stylesheet" href="{% static 'css/style.css' %}">
    <title>ChatCord App</title>
  </head>
  <body>
    <div class="chat-container">
      <header class="chat-header">
        <h1><i class="fas fa-smile"></i> ChatCord</h1>
        <a href="{% url 'logout' %}" class="btn">Log out</a>
      </header>
      <main class="chat-main">
        <div class="chat-messages">
            <div class="message">
                          <p class="meta">{{accounts.user.username}}
                              <span>9:12pm</span>
                          </p>
              <p class="text">
                          hello
              </p>
            </div>
            <div class="message">
              <p class="meta">Mary <span>9:15pm</span></p>
              <p class="text">
                          hello
              </p>
            </div>
        </div>
      </main>
      <div class="chat-form-container">
        <form id="chat-form">
          <input
            id="msg"
            type="text"
            placeholder="Enter Message"
            required
            autocomplete="off"
          />
          <button class="btn"><i class="fas fa-paper-plane"></i> Send</button>
        </form>
      </div>
    </div>
  </body>
  <script type = "text/javascript" src="https://ajax.googleapis.com/ajax/libs/jquery/3.5.1/jquery.min.js">
  </script>
  <script type = "text/javascript">
    // $(document).ready(function () {
      var url = 'ws://' + window.location.host + '/ws/chat/' + '{{id}}/';
      var chatSocket = new WebSocket(url);

      chatSocket.onopen = (event) => {
        var $input = $("#msg");
        var $submit = $(".btn");
        $submit.click((e) => {
          e.preventDefault()
          var message = $input.val();
          if (message){
            chatSocket.send(JSON.stringify({'message': message}));
            $input.val('');
          }
          $input.focus();
        });
      }

      chatSocket.onmessage = (event) => {
        var data = JSON.parse(event.data);
        console.log(data)
        var message = data.message;
        var username = data.sender
        var time =  new Date().toLocaleTimeString([], {hour: '2-digit', minute:'2-digit'});
        console.log(time)
      }
    // })
  </script>
</html>
